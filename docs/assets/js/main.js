"use strict";const searchButtonEl=document.querySelector(".search__button"),searchInputEl=document.querySelector(".search__input"),searchResponseEl=document.querySelector(".results-list"),favoriteSectionEl=document.querySelector(".favorite-list");let favorites=[];function deleteFavorite(e){const t=e.currentTarget.parentElement.dataset.id,a=favorites.findIndex(e=>e.id===t);favorites.splice(a,1),e.currentTarget.parentElement.remove();const s=document.getElementById(`${t}`);s&&s.classList.remove("results-section__card--selected"),localStorage.setItem("favorites",JSON.stringify(favorites))}function closeModalNotification(e){e.currentTarget.parentElement.remove()}function getFavorites(){const e=document.querySelectorAll(".favorite"),t=[];return e.forEach(e=>{t.push(e.dataset.id)}),t}function checkFavorite(e,t){t.includes(e.id)&&e.classList.add("results-section__card--selected")}function createNotification(e){const t=document.createElement("div"),a=document.createTextNode(e),s=document.createElement("i");s.classList.add("fas"),s.classList.add("fa-times"),s.classList.add("fa-sm"),s.classList.add("modal__close-button"),t.classList.add("modal"),t.appendChild(a),t.appendChild(s),searchResponseEl.appendChild(t),s.addEventListener("click",closeModalNotification)}function createFavoriteCard(e){const t=document.createElement("li"),a=document.createElement("h2"),s=document.createElement("img"),r=document.createElement("i"),i=document.createTextNode(e.name);t.setAttribute("data-id",e.id),s.setAttribute("style",`background-image: ${e.img}`),s.classList.add("favorite__image"),t.classList.add("favorite"),a.classList.add("favorite__title"),r.classList.add("fas"),r.classList.add("fa-times"),r.classList.add("fa-sm"),r.classList.add("favorite-erase"),t.appendChild(a),t.appendChild(s),favoriteSectionEl.appendChild(t),a.appendChild(i),t.appendChild(r),r.addEventListener("click",deleteFavorite)}function createSeriesCard(e){const t=document.createElement("li"),a=document.createElement("h2"),s=document.createElement("img"),r=document.createTextNode(e.name);return t.classList.add("results-section__card"),s.classList.add("results-card__image"),t.classList.add("results-section__card"),t.setAttribute("id",`${e.id}`),null===e.image?s.setAttribute("style","background-image: url(https://via.placeholder.com/210x295/ffffff/666666/?text=TV)"):s.setAttribute("style",`background-image: url(${e.image.medium})`),a.appendChild(r),t.appendChild(a),searchResponseEl.appendChild(t),t.appendChild(s),t}function cardClickFavoriteHandler(e){if(!1===e.currentTarget.classList.contains("results-section__card--selected")){e.currentTarget.classList.add("results-section__card--selected");const t={id:e.currentTarget.id,name:e.currentTarget.firstChild.innerHTML,img:e.currentTarget.firstChild.nextElementSibling.style.backgroundImage};createFavoriteCard(t),favorites.push(t),localStorage.setItem("favorites",JSON.stringify(favorites))}else if(!0===e.currentTarget.classList.contains("results-section__card--selected")){e.currentTarget.classList.remove("results-section__card--selected");const t=document.getElementById(`${e.currentTarget.id}`),a=favorites.findIndex(e=>e.id===t),s=document.querySelector(`[data-id='${e.currentTarget.id}']`);favorites.splice(a,1),s&&s.remove(),localStorage.setItem("favorites",JSON.stringify(favorites))}}if(localStorage.favorites){favorites=JSON.parse(localStorage.getItem("favorites"));for(const e of favorites)createFavoriteCard(e)}function searchSeries(e){fetch(`http://api.tvmaze.com/search/shows?q=${e}`).then(e=>e.json()).then(function(e){if(0===e.length)createNotification("Tu búsqueda no ha dado ningún resultado, por favor, inténtalo de nuevo con otra serie");else{searchResponseEl.innerHTML="";const t=getFavorites();for(const a of e){const e=createSeriesCard(a.show);e.addEventListener("click",cardClickFavoriteHandler),checkFavorite(e,t)}}})}function searchButtonClickHandler(){""===searchInputEl.value?createNotification("Por favor, introduce una serie en el buscador"):searchSeries(searchInputEl.value)}searchButtonEl.addEventListener("click",searchButtonClickHandler);